<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - WebAppScanner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="/" class="logo">WebApp<span class="highlight">Scanner</span></a>
                <a href="/login" class="btn btn-secondary">Login</a>
            </nav>
        </div>
    </header>

    <main>
        <div class="scan-container">
            <h2>Create an Account</h2>
            <form id="signup-form">
                 <label for="username">Username:</label>
                <div class="input-group">
                    <input type="text" id="username" name="username" required placeholder="Choose a username">
                </div>
                <br>
                <label for="email">Email:</label>
                <div class="input-group">
                    <input type="email" id="email" name="email" required placeholder="you@example.com">
                </div>
                <br>
                <label for="password">Password:</label>
                <div class="input-group">
                    <input type="password" id="password" name="password" required placeholder="Create a Password">
                </div>
                <br>
                <button type="submit" class="btn btn-primary">Create Account</button>
                <p id="error-message" style="color: red; margin-top: 15px;"></p>
            </form>
        </div>
    </main>

    <script type="module">
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDietl_rT9JvgMr58t86yho93l9EQmmGPM",
        authDomain: "webappscanner-auth.firebaseapp.com",
        projectId: "webappscanner-auth",
        storageBucket: "webappscanner-auth.appspot.com",
        messagingSenderId: "525787109456",
        appId: "1:525787109456:web:ef8f218e8a2babde4d9955",
        measurementId: "G-ZCC272RLKH"
      };

      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // --- Signup Logic ---
      const signupForm = document.getElementById('signup-form');
      const errorMessage = document.getElementById('error-message');

      signupForm.addEventListener('submit', (e) => {
          e.preventDefault(); // Prevent the form from submitting the traditional way
          
          const email = signupForm.email.value;
          const password = signupForm.password.value;
          const username = signupForm.username.value;

          createUserWithEmailAndPassword(auth, email, password)
              .then((userCredential) => {
                  // Signed in successfully
                  const user = userCredential.user;
                  console.log('Successfully created user:', user);
                  
                  // Set the flag to show the welcome message on the next page
                  sessionStorage.setItem('showWelcome', 'true');
                  
                  // Redirect to the main scanner page after successful signup
                  window.location.href = '/scan';
              })
              .catch((error) => {
                  // Handle Errors here.
                  const errorCode = error.code;
                  const friendlyMessage = errorCode.replace('auth/', '').replace(/-/g, ' ');
                  errorMessage.textContent = `Error: ${friendlyMessage}`;
                  console.error('Signup Error:', error);
              });
      });
    </script>    

</body>
</html>

